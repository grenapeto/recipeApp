<mat-card>
    <form [formGroup]="recipeForm" (ngSubmit)="onSubmit()">
      <h2>Add New Recipe</h2>
  
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Recipe Name</mat-label>
        <input matInput formControlName="name" required />
        <mat-error *ngIf="recipeForm.get('name')?.invalid && recipeForm.get('name')?.touched">
            Recipe name is required.
          </mat-error>
      </mat-form-field>
  
      <div formArrayName="ingredients" class="form-section">
        <h2>Ingredients</h2>
        <button mat-raised-button class="button-color" (click)="addIngredient()" type="button">
          Add Ingredient
        </button>
        <div *ngFor="let ingredient of ingredients.controls; let i = index" class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>{{ i + 1 }} Ingredient </mat-label>
            <input matInput [formControlName]="i" required />
            <mat-error *ngIf="recipeForm.get('ingredients')?.invalid && recipeForm.get('ingredients')?.touched">
                Ingredient is required.
              </mat-error>
          </mat-form-field>
          <button mat-icon-button color="warn" (click)="removeIngredient(i)" type="button">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>

      <div formArrayName="instructions" class="form-section">
        <h2>Instructions</h2>
        <button mat-raised-button class="button-color" (click)="addInstruction()" type="button">
          Add Instruction
        </button>
        <div *ngFor="let instruction of instructions.controls; let j = index" class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>{{ j + 1 }} Line of Instruction </mat-label>
            <textarea matInput [formControlName]="j" required></textarea>
            <mat-error *ngIf="recipeForm.get('instructions')?.invalid && recipeForm.get('instructions')?.touched">
                Instructions are required.
              </mat-error>
          </mat-form-field>
          <button mat-icon-button color="warn" (click)="removeInstruction(j)" type="button">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
      </div>

      <div formArrayName="images" class="form-section">
        <h2>Image</h2>
        <button mat-raised-button class="button-color" (click)="uploader.open({ onUpdate: onComplete })">
          Upload Image
        </button>
        <div *ngFor="let image of images.controls; let l = index" class="form-row">
            <mat-form-field appearance="outline">
              <mat-label>Images {{ l + 1 }}</mat-label>
              <input matInput [formControlName]="l" required readonly="readonly">
            </mat-form-field>
            <button mat-icon-button color="warn" (click)="removeImage(l)" type="button">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
      </div>

      <button mat-raised-button class="add-recipe-button" type="submit">Add Recipe</button>
    </form>
  </mat-card>

  <mat-card *ngIf="lastAddedRecipe" >
    <mat-card-title>{{ lastAddedRecipe.name }}</mat-card-title>
    <mat-card-content class="last-recipe">
    <h2>Ingredients:</h2>
      <ul>
        <li *ngFor="let ingredient of lastAddedRecipe.ingredients">{{ ingredient }}</li>
      </ul>

      <h2>Instructions:</h2>
      <ol>
        <li *ngFor="let instruction of lastAddedRecipe.instructions">{{ instruction }}</li>
      </ol>

      <div *ngFor="let image of lastAddedRecipe.images">
        <img [src]="image" alt="Recipe Image" class="uploaded-image" />
      </div>

       <div *ngFor="let image of images.controls; let k = index" class="form-row">
        <img [src]="image.value" alt="Recipe Image" class="uploaded-image" />
        <button mat-icon-button color="warn" (click)="removeImage(k)" type="button">
          <mat-icon>delete</mat-icon>
        </button>
      </div>

    </mat-card-content>
  </mat-card>
  